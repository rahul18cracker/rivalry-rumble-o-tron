# Tools Debug Guide

## Tool Inventory

| Tool | File | Purpose | API Key Required |
|------|------|---------|------------------|
| `get_company_financials` | `yfinance_tools.py` | Get financial metrics | No |
| `get_historical_revenue` | `yfinance_tools.py` | Get revenue history | No |
| `get_company_comparison` | `yfinance_tools.py` | Compare multiple companies | No |
| `search_company_info` | `tavily_tools.py` | General company research | Yes (TAVILY_API_KEY) |
| `search_competitive_analysis` | `tavily_tools.py` | Competitive positioning | Yes (TAVILY_API_KEY) |
| `search_product_info` | `tavily_tools.py` | Product details | Yes (TAVILY_API_KEY) |
| `search_market_trends` | `tavily_tools.py` | Market/industry trends | Yes (TAVILY_API_KEY) |

## Testing Data Sources

### yfinance (No API Key)
```python
# Quick test
import yfinance as yf
for ticker in ['DDOG', 'DT', 'CSCO']:
    t = yf.Ticker(ticker)
    info = t.info
    print(f"{ticker}: {info.get('shortName')} - MCap: {info.get('marketCap')}")
```

### Tavily (Needs API Key)
```python
# Quick test
import os
from tavily import TavilyClient

client = TavilyClient(api_key=os.getenv('TAVILY_API_KEY'))
result = client.search('DataDog observability platform')
print(f"Found {len(result['results'])} results")
```

## API Key Configuration

### .env file
```bash
# Required for Tavily tools
TAVILY_API_KEY=your_key_here

# Required for LLM (Claude)
ANTHROPIC_API_KEY=your_key_here
```

### Getting API Keys
- **Tavily**: https://tavily.com (free tier: 1000 requests/month)
- **Anthropic**: https://console.anthropic.com/

## Rate Limits

| Service | Free Tier | Paid Tier |
|---------|-----------|-----------|
| yfinance | Unlimited* | Unlimited* |
| Tavily | 1000 req/month | Higher limits |

*yfinance uses Yahoo Finance public data, may have informal rate limits

## Testing Individual Tools

### get_company_financials
```python
from src.tools.yfinance_tools import get_company_financials

result = get_company_financials.invoke({"ticker": "DDOG"})
print(result)
# Expected: {company_name, ticker, market_cap, revenue_ttm, ...}
```

### search_company_info
```python
from src.tools.tavily_tools import search_company_info

result = search_company_info.invoke({"company_name": "DataDog"})
print(result)
# Expected: {company, results: [...], sources: [...]}
```

## Mock Data for Offline Development

### Mock Financial Data
```python
MOCK_FINANCIAL = {
    "DDOG": {
        "company_name": "Datadog, Inc.",
        "ticker": "DDOG",
        "market_cap": "$45.2B",
        "revenue_ttm": "$2.1B",
        "revenue_growth_yoy": "25.3%",
        "gross_margin": "80.1%",
    },
    "DT": {
        "company_name": "Dynatrace, Inc.",
        "ticker": "DT",
        "market_cap": "$15.8B",
        "revenue_ttm": "$1.4B",
        "revenue_growth_yoy": "22.1%",
        "gross_margin": "82.5%",
    },
    "CSCO": {
        "company_name": "Cisco Systems, Inc.",
        "ticker": "CSCO",
        "market_cap": "$220B",
        "revenue_ttm": "$56B",
        "revenue_growth_yoy": "8.2%",
        "gross_margin": "64.3%",
    },
}
```

### Mock Competitive Data
```python
MOCK_COMPETITOR = {
    "DataDog": {
        "products": ["APM", "Infrastructure", "Logs", "RUM", "Security"],
        "target_market": "Cloud-native enterprises",
        "pricing_model": "Usage-based",
        "strengths": ["Unified platform", "700+ integrations", "Cloud-native"],
        "weaknesses": ["Expensive at scale", "Complex pricing"],
    },
}
```

## Common Issues

### 1. yfinance Returns Empty Data
**Symptom**: `info.get('marketCap')` returns None
**Cause**: Yahoo Finance may have temporary issues
**Fix**: Add retry logic or check for None values

### 2. Tavily API Key Error
**Symptom**: "TAVILY_API_KEY environment variable not set"
**Fix**: Ensure .env file exists and is loaded:
```python
from dotenv import load_dotenv
load_dotenv()  # Call before using Tavily
```

### 3. Tool Not Found by Agent
**Symptom**: Agent doesn't recognize tool
**Fix**: Ensure tool is in the TOOLS list passed to `llm.bind_tools()`

### 4. Rate Limit Hit
**Symptom**: API returns rate limit error
**Fix**: Add caching or use mock data for development
