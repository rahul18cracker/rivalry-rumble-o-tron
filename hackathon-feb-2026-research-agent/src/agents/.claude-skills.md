# Agents Debug Guide

## Agent Inventory

| Agent | File | Purpose | Tools |
|-------|------|---------|-------|
| Manager | `manager.py` | Orchestrates research, delegates to sub-agents | None (orchestration only) |
| Financial | `financial.py` | Analyzes financial data | yfinance_tools |
| Competitor | `competitor.py` | Researches competitive positioning | tavily_tools |

## Testing Individual Agents

### Financial Agent
```python
# Test financial agent
import asyncio
from src.agents.financial import run_financial_agent

result = asyncio.run(run_financial_agent(
    "Analyze financial metrics",
    tickers=["DDOG", "DT", "CSCO"]
))
print(result)
```

### Competitor Agent
```python
# Test competitor agent
import asyncio
from src.agents.competitor import run_competitor_agent

result = asyncio.run(run_competitor_agent(
    "Analyze competitive positioning",
    companies=["DataDog", "Dynatrace", "Splunk"]
))
print(result)
```

### Manager Agent (Full Orchestration)
```python
# Test full orchestration
import asyncio
from src.agents.manager import run_manager_agent

report = asyncio.run(run_manager_agent(
    "Compare Cisco's observability portfolio to DataDog and Dynatrace"
))
print(report)
```

## Output Schemas

### Financial Agent Output
```python
{
    "task": "string",
    "tickers": ["DDOG", "DT", "CSCO"],
    "response": "string (LLM response with financial analysis)",
    "message_count": 5
}
```

### Competitor Agent Output
```python
{
    "task": "string",
    "companies": ["DataDog", "Dynatrace", "Splunk"],
    "response": "string (LLM response with competitive analysis)",
    "message_count": 5
}
```

## Common Issues

### 1. Agent Not Calling Tools
**Symptom**: Agent returns response without using tools
**Fix**: Check that tools are properly bound to LLM:
```python
llm_with_tools = llm.bind_tools(TOOLS)
```

### 2. Infinite Tool Loop
**Symptom**: Agent keeps calling tools repeatedly
**Fix**: Check `should_continue` function returns `END` when no tool calls

### 3. State Not Updating
**Symptom**: State values don't persist between nodes
**Fix**: Return dict with updated keys from node functions

### 4. Async/Sync Mismatch
**Symptom**: "coroutine was never awaited" error
**Fix**: Use `asyncio.run()` or await properly:
```python
# Wrong
result = run_financial_agent(task, tickers)

# Right
result = await run_financial_agent(task, tickers)
# or
result = asyncio.run(run_financial_agent(task, tickers))
```

## Architecture

```
Manager Agent
├── parse_request (node)
│   └── Uses LLM to extract companies/tickers
├── execute_tasks (node)
│   ├── run_financial_agent (parallel)
│   └── run_competitor_agent (parallel)
└── synthesize_report (node)
    └── Uses LLM to create final report

Financial Agent (LangGraph ReAct pattern)
├── agent (node) - LLM decides action
├── tools (node) - Execute yfinance tools
└── Loop until no more tool calls

Competitor Agent (LangGraph ReAct pattern)
├── agent (node) - LLM decides action
├── tools (node) - Execute tavily tools
└── Loop until no more tool calls
```
